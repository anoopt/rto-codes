# Project Structure Guide

This document explains the organization of the codebase, focusing on the data architecture and automation scripts.

## üìÇ `../data/` Directory

The `../data/` directory is the single source of truth for the application. It follows a specific hierarchical structure essential for the static site generation process.

### Root Files

| File              | Description                                                                                                                                    |
| ----------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| `index.json`      | **AUTO-GENERATED.** The master registry of all RTO codes across all states. Generated by `../scripts/generate-index.ts`. Do not edit manually. |
| `rto-images.json` | **AUTO-GENERATED.** Maps RTO codes to their Cloudinary public IDs for OpenGraph images. Generated by `../scripts/generate-rto-images.ts`.      |

### State Directories (e.g., `../data/karnataka/`)

Each state or union territory has its own folder containing specific configuration and data.

| File          | Type          | Description                                                                                                                   |
| ------------- | ------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| `config.json` | **Config**    | JSON Configuration for the state. Includes `stateCode` ("KA"), `name`, `districtMapping` (for maps), and `isComplete` status. |
| `index.json`  | **Generated** | **AUTO-GENERATED.** A summarized list of all _valid_ RTOs in this state. Used for listing pages.                              |
| `map.svg`     | **Asset**     | (Optional) SVG map of the state with paths strictly named by district IDs matching `config.json`.                             |
| `xx-yy.json`  | **Data**      | Individual RTO files (e.g., `ka-01.json`). **This is where contributors add data.**                                           |
| `README.md`   | **Doc**       | State-specific notes or progress tracking.                                                                                    |

#### Why separate files?

We use one file per RTO (e.g., `ka-01.json`, `ka-02.json`) instead of one giant JSON file to:

1.  **Reduce Merge Conflicts**: Multiple contributors can add different RTOs simultaneously without conflict.
2.  **Cleaner Diffs**: Pull requests are easier to review.
3.  **granular Validation**: We can validate files individually.

---

## üìú `../scripts/` Directory

This project relies heavily on automation scripts to maintain data integrity and generate performance optimizations. **Always run these with `bun`.**

### üü¢ Core & Build Scripts

These run automatically during development or build processes.

- **`generate-index.ts`** (`bun run generate:index`)

  - **Crucial.** Scans all state folders and individual JSON files.
  - Generates the master `../data/index.json` and state-level `index.json` files.
  - **Must run** after adding any new RTO file for it to appear in the app.

- **`generate-sitemap.ts`**
  - Scans available RTOs and generates `../public/sitemap.xml` for SEO.

### üü° Validation & Quality

Tools for contributors to check their work.

- **`validate-rto-data.ts`**

  - Validates JSON structure and logic.
  - Can use AI (Gemini) to cross-reference data if API key is present.
  - Usage: `bun ../scripts/validate-rto-data.ts <state> [code]`

- **`verify-total-rtos.ts`**

  - Cross-references current file counts against the expected `totalRTOs` defined in `config.json`.

- **`fix-rto-data.ts` / `validate-and-fix-rto-data.ts`**
  - Helper scripts to blindly or intelligently fix common formatting issues (e.g., whitespace, capitalization).

### üî¥ Maintainer / Automation

Scripts primarily used by maintainers for bulk updates or asset generation.

- **`populate-rto-data.ts`**

  - Uses AI to generate initial JSON files for a state based on a scaffolding.
  - **Requires API Keys.**

- **`fetch-rto-data.ts`**

  - Scraper/fetcher for initial raw data gathering.

- **`generate-rto-images.ts`**

  - Generates social media preview cards (Open Graph images) locally or via Cloudinary.
  - Updates `../data/rto-images.json`.

- **`generate-icons.ts`**
  - Generates PWA icons from a master SVG.

---

## üèóÔ∏è Application Directories

### `../app/` (Next.js App Router)

- **`rto/[code]/page.tsx`**: The dynamic route that renders every single RTO page. It uses `generateStaticParams` to statically generate pages at build time based on the data files.
- **`api/`**: We mostly do NOT use API routes because this is a static site. Data is imported directly during build.

### `../components/`

- **`DistrictMap.tsx`**: Handles the interactive SVG map logic, highlighting districts based on the current RTO.
- **`SearchableRTOs.tsx`**: The client-side search component using Fuse.js.

### `../lib/`

- **`rto-data.ts`**: Helper functions to read files from the `../data/` directory. (Note: These only work on the server/build side, not in the browser).

### `../types/`

- **`rto.ts`**: Defines the `RTOCode` interface. **Consult this when adding new data fields.**
