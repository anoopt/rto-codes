# AGENTS.md - AI Agent Instructions for RTO Codes India

This document provides guidance for AI agents (GitHub Copilot, Claude, GPT, etc.) working on the RTO Codes India codebase.

## Project Overview

**RTO Codes India** is a Next.js 16+ web application that serves as a comprehensive, searchable database of RTO (Regional Transport Office) codes in India. The project currently covers Karnataka and Goa, with plans to expand to other Indian states.

- **Live Site**: [https://rto-codes.in](https://rto-codes.in)
- **Framework**: Next.js 16+ with React 19 and TypeScript
- **Styling**: Tailwind CSS 4
- **Package Manager**: **Bun** (always use `bun` instead of `npm` or `yarn`)
- **Deployment**: Vercel

## Critical Rules

### Package Manager

**ALWAYS use `bun` instead of `npm`, `yarn`, or `pnpm`:**

```bash
# ✅ Correct
bun install
bun run dev
bun run build
bun run lint
bun add <package>
bun add -d <package>  # dev dependency
bun scripts/generate-index.ts

# ❌ Never use
npm install
yarn add
pnpm install
```

### File Structure

```
rtocodes/
├── app/                    # Next.js App Router pages
│   ├── layout.tsx          # Root layout
│   ├── page.tsx            # Home page
│   ├── globals.css         # Global styles (Tailwind)
│   ├── about/              # About page
│   ├── contribute/         # Contribution guidelines page
│   └── rto/[code]/         # Dynamic RTO detail pages
├── components/             # React components
├── data/                   # RTO JSON data files
│   ├── index.json          # Auto-generated master index
│   ├── rto-images.json     # Auto-generated image mappings
│   ├── karnataka/          # Karnataka RTO data
│   │   ├── config.json     # State configuration
│   │   ├── index.json      # State index (auto-generated)
│   │   ├── map.svg         # State district map
│   │   └── ka-*.json       # Individual RTO files
│   └── goa/                # Goa RTO data
│       └── ga-*.json       # Individual RTO files
├── lib/                    # Utility functions
├── types/                  # TypeScript type definitions
├── scripts/                # Build and data scripts
└── public/                 # Static assets
```

### Auto-Generated Files (DO NOT MANUALLY EDIT)

These files are generated by scripts and should never be edited manually:

- `data/index.json` - Generated by `bun scripts/generate-index.ts`
- `data/*/index.json` - State-level index files
- `data/rto-images.json` - Generated by `bun scripts/generate-rto-images.ts`
- `public/sitemap.xml` - Generated by `bun scripts/generate-sitemap.ts`

These scripts run automatically during build via the `prebuild` script.

## Development Commands

```bash
# Start development server (with Turbopack)
bun run dev

# Build for production
bun run build

# Start production server
bun run start

# Lint code
bun run lint

# Generate index files manually
bun scripts/generate-index.ts

# Generate sitemap
bun scripts/generate-sitemap.ts

# Validate RTO data
bun scripts/validate-rto-data.ts [state]

# Populate RTO data with AI (requires GEMINI_API_KEY)
bun scripts/populate-rto-data.ts <state>
```

## TypeScript Types

### RTOCode Interface

The main data type for RTO entries is defined in [types/rto.ts](types/rto.ts):

```typescript
interface RTOCode {
  code: string; // e.g., "KA-01"
  region: string; // e.g., "Koramangala"
  city: string; // e.g., "Bengaluru"
  state: string; // "Karnataka"
  stateCode: string; // "KA"
  district?: string; // "Bengaluru Urban"
  division?: string; // "Bengaluru Urban Division"
  description?: string; // RTO description
  status?: "active" | "not-in-use" | "discontinued";
  established?: string; // Year or "N/A"
  address?: string; // Physical address
  pinCode?: string; // 6-digit PIN code
  phone?: string; // Contact number(s)
  email?: string; // Official email
  jurisdictionAreas?: string[]; // Areas under this RTO
  redirectTo?: string; // For inactive RTOs, redirect to this code
  isDistrictHeadquarter?: boolean;
}
```

### State Configuration

State configuration is in `data/<state>/config.json`:

```typescript
interface StateConfig {
  stateCode: string; // "KA"
  name: string; // "karnataka"
  displayName: string; // "Karnataka"
  capital: string; // "Bengaluru"
  totalRTOs: number; // Expected total RTOs
  mapFile: string; // "map.svg"
  districtMapping: Record<string, string>; // District to SVG ID mapping
  svgDistrictIds: string[]; // List of SVG district IDs
}
```

## Data Conventions

### RTO Code Naming

- Format: `XX-YY` or `XX-YYY` where `XX` is state code, `YY`/`YYY` is 2-3 digit number
- Filename: `xx-yy.json` or `xx-yyy.json` (lowercase)
- Examples: `ka-01.json`, `ga-12.json`, `mh-123.json`

### Required Fields for RTO Data

Every RTO JSON file must have:

1. `code` - The RTO code (e.g., "KA-01")
2. `region` - Area/region name
3. `city` - City name
4. `state` - Full state name
5. `stateCode` - 2-letter state code
6. `district` - District name

### Status Values

- `"active"` - Currently operational (default)
- `"not-in-use"` - Code exists but not actively used
- `"discontinued"` - No longer valid

When `status` is `"not-in-use"`, include:

- `redirectTo` - The active RTO code to redirect to
- `note` - Explanation for users

## Component Patterns

### React Server Components (Default)

Components are Server Components by default. Use `"use client"` only when needed:

```typescript
// Server Component (default) - can fetch data directly
export default async function Page() {
  const data = await getData();
  return <div>{data}</div>;
}

// Client Component - for interactivity
("use client");
export function SearchBar() {
  const [query, setQuery] = useState("");
  // ...
}
```

### Path Aliases

Use `@/` for imports from the project root:

```typescript
import { RTOCode } from "@/types/rto";
import { getAllRTOs } from "@/lib/rto-data";
import { Header } from "@/components/Header";
```

## Styling Guidelines

### Tailwind CSS 4

The project uses Tailwind CSS 4 with PostCSS:

```typescript
// Use Tailwind utility classes
<div className="flex items-center gap-4 p-4 bg-gray-900 rounded-lg">

// Dark mode is the default theme
// Use semantic color classes when available
```

### Theme Support

The project supports light/dark themes via `next-themes`:

```typescript
import { useTheme } from "next-themes";

const { theme, setTheme } = useTheme();
```

## Environment Variables

Create `.env.local` for local development (optional but recommended):

```bash
# Recommended: Cloudinary cloud name for RTO images
# Without this, the app works but images won't display
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=dfqx29jae

# Optional: Enable district map highlighting
NEXT_PUBLIC_ENABLE_DISTRICT_MAP=true
```

**Note**: The Cloudinary cloud name is a public identifier for fetching images and is safe to share. Without it, the app still compiles and runs - images simply won't display. Cloudinary API credentials and AI-related environment variables are only needed by maintainers. Image generation is handled exclusively by maintainers via GitHub Actions workflows.

## Adding New States

1. Create state folder: `data/<state-name>/`
2. Add `config.json` with state configuration
3. Add individual RTO files: `xx-01.json`, `xx-02.json`, etc.
4. Optionally add `map.svg` for district visualization
5. Run `bun scripts/generate-index.ts` to update indexes
6. Update `lib/state-config.ts` if needed

## Common Tasks

### Adding a New RTO

1. Create JSON file in appropriate state folder
2. Follow the RTOCode interface structure
3. Include all required fields
4. Run `bun scripts/validate-rto-data.ts <state>` to validate
5. The index will be regenerated on build

### Updating RTO Data

1. Edit the specific `xx-yy.json` file
2. Validate with `bun scripts/validate-rto-data.ts <state>`
3. Test locally with `bun run dev`

### Creating New Components

1. Create component in `components/` directory
2. Use TypeScript with proper types
3. Follow existing naming conventions (PascalCase)
4. Add `"use client"` directive only if needed

### Adding New Pages

1. Create folder in `app/` directory
2. Add `page.tsx` file
3. Use Server Components by default
4. Generate static params for dynamic routes

## Testing

Currently, the project uses ESLint for code quality:

```bash
bun run lint
```

For data validation:

```bash
bun scripts/validate-rto-data.ts karnataka
bun scripts/validate-rto-data.ts goa
```

## Deployment

The site deploys automatically to Vercel on push to `main` branch.

For manual deployment:

```bash
bun run build
bun run start  # Test production build locally
```

## Key Files Reference

| File                                                           | Purpose                    |
| -------------------------------------------------------------- | -------------------------- |
| [app/layout.tsx](app/layout.tsx)                               | Root layout with providers |
| [app/page.tsx](app/page.tsx)                                   | Home page                  |
| [app/rto/[code]/page.tsx](app/rto/[code]/page.tsx)             | RTO detail page            |
| [lib/rto-data.ts](lib/rto-data.ts)                             | Data fetching utilities    |
| [lib/state-config.ts](lib/state-config.ts)                     | State configuration        |
| [types/rto.ts](types/rto.ts)                                   | TypeScript types           |
| [components/SearchableRTOs.tsx](components/SearchableRTOs.tsx) | Search functionality       |

## Error Handling

- Use TypeScript strict mode for type safety
- Handle missing data gracefully with fallbacks
- Use Next.js error boundaries for runtime errors
- 404 pages are handled by `app/not-found.tsx`

## Performance Considerations

- Use Static Site Generation (SSG) where possible
- Images are optimized via Cloudinary (managed by maintainers)
- Minimize client-side JavaScript
- Use Server Components for data fetching

## Maintainer-Only Tasks

The following tasks are handled exclusively by maintainers:

- **Image Generation**: RTO images are generated via Cloudinary and managed through GitHub Actions workflows. Contributors should NOT run `bun scripts/generate-rto-images.ts`.
- **AI Data Enrichment**: The `populate-rto-data.ts` script uses AI to enrich RTO data and requires maintainer API keys.
- **Production Deployments**: Automatic via Vercel on merge to `main`.

## Contributing Code

1. Follow existing code patterns
2. Use TypeScript with proper types
3. Run `bun run lint` before committing
4. Test changes locally with `bun run dev`
5. Build successfully with `bun run build`

---

**Remember**: Always use `bun` for all package management and script execution!
